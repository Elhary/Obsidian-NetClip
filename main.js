/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var V=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var re=(c,t)=>{for(var e in t)V(c,e,{get:t[e],enumerable:!0})},ae=(c,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ne(t))!se.call(c,n)&&n!==e&&V(c,n,{get:()=>t[n],enumerable:!(i=ie(t,n))||i.enumerable});return c};var oe=c=>ae(V({},"__esModule",{value:!0}),c);var ce={};re(ce,{default:()=>P});module.exports=oe(ce);var f=require("obsidian");var X=require("obsidian");function x(c){try{let t=new URL(c);return["utm_source","utm_medium","utm_campaign","utm_term","utm_content","fbclid","gclid"].forEach(i=>{t.searchParams.delete(i)}),t.toString()}catch(t){return null}}function G(c){return c.replace(/[\/\\:*?"<>|]/g,"_").replace(/\s+/g," ").trim()}function k(c){try{return new URL(c).hostname.replace(/^www\./,"")}catch(t){return"Unknown Domain"}}var z=require("obsidian"),S=class extends z.Modal{constructor(e,i,n){super(e);this.file=i,this.onConfirmDelete=n}onOpen(){this.titleEl.setText("Confirm Delete"),this.contentEl.createEl("p",{text:`Are you sure you want to delete the article "${this.file.basename}"?`});let e=this.contentEl.createEl("div",{cls:"netclip_button-container"}),i=e.createEl("button",{cls:"mod-warning",text:"Delete"}),n=e.createEl("button",{text:"Cancel"});i.addEventListener("click",async()=>{await this.onConfirmDelete(),this.close()}),n.addEventListener("click",()=>{this.close()})}onClose(){this.contentEl.empty()}};var E=require("obsidian");var T=require("obsidian");var Z=require("obsidian");var K={google:"https://www.google.com/search?q=",youtube:"https://www.youtube.com/results?search_query=",bing:"https://www.bing.com/search?q=",perplexity:"https://www.perplexity.ai/search/new?q=",duckduckgo:"https://duckduckgo.com/?q=",genspark:"https://www.genspark.ai/search?query=",kagi:"https://kagi.com/search?q=",yahoo:"http://search.yahoo.com/search?p="};var Q=require("obsidian"),Y=(c,t,e,i)=>{if(e.innerHTML="",!c||c.trim()===""){t.style.display="none";return}(0,Q.requestUrl)({url:`https://suggestqueries.google.com/complete/search?client=chrome&q=${encodeURIComponent(c)}`,method:"GET",headers:{"User-Agent":"Mozilla/5.0",Accept:"application/json"}}).then(n=>{if(n.status!==200)throw new Error(`HTTP error! status: ${n.status}`);try{let s=JSON.parse(n.text)[1]||[];t.style.display=s.length>0?"block":"none",s.forEach(a=>{let l=document.createElement("div");l.classList.add("netClip-suggestion-item");let o=document.createElement("span");o.classList.add("search_icon"),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>';let p=document.createElement("span");p.textContent=a,l.appendChild(o),l.appendChild(p),l.onclick=()=>i(a),e.appendChild(l)})}catch(r){console.error("Error parsing suggestions:",r),t.style.display="none"}}).catch(n=>{console.error("Error fetching suggestions:",n),t.style.display="none"})};var L=class{constructor(t,e,i,n={}){this.currentSuggestionIndex=-1;this.baseSearchUrls=K;this.searchInput=t,this.suggestionContainer=e,this.suggestionsBox=i,this.settings={searchEngine:"google",...n},this.setupEventListeners()}setupEventListeners(){this.searchInput.addEventListener("input",()=>{let t=this.searchInput.value.trim();t===""?this.hideSuggestions():Y(t,this.suggestionContainer,this.suggestionsBox,this.selectSuggestion.bind(this))}),this.searchInput.addEventListener("keydown",t=>{let e=this.suggestionsBox.children;switch(t.key){case"ArrowDown":t.preventDefault(),this.navigateSuggestions("down",e);break;case"ArrowUp":t.preventDefault(),this.navigateSuggestions("up",e);break;case"Enter":t.preventDefault(),this.handleEnterKey(e);break;case"Escape":this.hideSuggestions();break}}),document.addEventListener("click",t=>{!this.searchInput.contains(t.target)&&!this.suggestionContainer.contains(t.target)&&this.hideSuggestions()})}isValidUrl(t){try{return new URL(t),!0}catch(e){return!1}}constructSearchUrl(t){let e=this.settings.searchEngine||"google",i=this.baseSearchUrls[e],n=encodeURIComponent(t.trim());return`${i}${n}`}navigateToQuery(t){let e=this.isValidUrl(t)?t:this.constructSearchUrl(t),i=new CustomEvent("search-query",{detail:{url:e,query:t}});return this.searchInput.dispatchEvent(i),e}selectSuggestion(t){this.searchInput.value=t,this.navigateToQuery(t),this.hideSuggestions()}navigateSuggestions(t,e){if(e.length!==0)if(this.currentSuggestionIndex!==-1&&e[this.currentSuggestionIndex].classList.remove("selected"),t==="down"?this.currentSuggestionIndex=this.currentSuggestionIndex<e.length-1?this.currentSuggestionIndex+1:-1:this.currentSuggestionIndex=this.currentSuggestionIndex>-1?this.currentSuggestionIndex-1:e.length-1,this.currentSuggestionIndex===-1)this.searchInput.value=this.searchInput.getAttribute("data-original-value")||"";else{let i=e[this.currentSuggestionIndex];i.classList.add("selected"),this.searchInput.value=i.textContent||""}}handleEnterKey(t){if(this.currentSuggestionIndex!==-1&&t[this.currentSuggestionIndex])t[this.currentSuggestionIndex].click();else{let e=this.searchInput.value;e&&this.navigateToQuery(e)}this.hideSuggestions()}hideSuggestions(){this.suggestionContainer.style.display="none",this.suggestionsBox.innerHTML="",this.currentSuggestionIndex=-1}};var v=class{constructor(t,e,i={},n){this.app=t;this.isFrameReady=!1;this.navigationHistory=[];this.currentHistoryIndex=-1;this.url=e,this.settings={defaultWidth:"100%",defaultHeight:"100%",searchEngine:"google",fitToContainer:!0,...i},this.onClipCallback=n}createContainer(){let t=document.createElement("div");t.classList.add("netClip_webview_container");let e=t.createDiv("netClip_web_controls");return this.setupNavigationBtns(e),this.setupSearchInput(e),this.setupClipBtn(e),this.setupFrameContainer(t),this.navigationHistory.push(this.url),this.currentHistoryIndex=0,t}setupSearchInput(t){let e=t.createDiv("netClip_search_container");this.searchInput=e.createEl("input",{type:"text",placeholder:"Search...",value:this.url});let i=e.createDiv("netClip_query_box"),n=i.createDiv("netClip_suggestions");this.search=new L(this.searchInput,i,n,{searchEngine:this.settings.searchEngine}),this.searchInput.addEventListener("search-query",r=>{let{url:s}=r.detail;this.navigateTo(s)})}setupClipBtn(t){if(this.onClipCallback){let e=t.createDiv("netClip_clip_btn_container");this.clipBtn=e.createEl("button",{text:"Clip"}),this.clipBtn.onclick=()=>{var i;(i=this.onClipCallback)==null||i.call(this,this.getCurrentUrl())}}}setupNavigationBtns(t){let e=t.createDiv("netClip_nav_left");this.backBtn=e.createEl("button",{cls:"netClip_back_btn netClip_btn"}),this.backBtn.innerHTML=`
        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg>
        `,this.backBtn.onclick=()=>this.goBack(),this.backBtn.disabled=!0,this.forwardBtn=e.createEl("button",{cls:"netClip_forward_btn netClip_btn"}),this.forwardBtn.innerHTML=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
        `,this.forwardBtn.onclick=()=>this.goForward(),this.forwardBtn.disabled=!0;let i=e.createEl("button",{cls:"netClip_refresh_btn netClip_btn"});i.innerHTML=`
        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-ccw"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
        `,i.onclick=()=>this.refresh()}setupFrameContainer(t){let e=t.createDiv("netClip_frame-container");return e.style.flexGrow="1",e.style.position="relative",e.style.overflow="hidden",this.loadingSpinner=e.createDiv("loading-spinner"),this.loadingSpinner.style.position="absolute",this.loadingSpinner.style.display="none",this.frame=this.createFrame(),e.appendChild(this.frame),e}createFrame(){return Z.Platform.isMobileApp?this.createIframe():this.createWebview()}createIframe(){let t=document.createElement("iframe");return t.setAttribute("allowpopups",""),t.setAttribute("credentialless","true"),t.setAttribute("crossorigin","anonymous"),t.setAttribute("src",this.url),t.setAttribute("sandbox","allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts allow-top-navigation-by-user-activation"),t.setAttribute("allow","encrypted-media;fullscreen;oversized-images;picture-in-picture;sync-xhr;geolocation"),t.style.width="100%",t.style.height="100%",t.style.border="none",t.style.objectFit="contain",t.style.backgroundColor="#f0f0f0",t.addEventListener("load",()=>{this.onFrameLoad()}),t}createWebview(){let t=document.createElement("webview");return t.allowpopups=!0,t.src=this.url,t.style.width="100%",t.style.height="100%",t.style.border="none",t.style.backgroundColor="#f0f0f0",t.style.objectFit="contain",t.addEventListener("dom-ready",()=>{this.isFrameReady=!0,this.updateUrlDisplay(),this.loadingSpinner.style.display="none"}),t.addEventListener("did-start-loading",()=>{this.loadingSpinner.style.display="block"}),t.addEventListener("did-stop-loading",()=>{this.loadingSpinner.style.display="none"}),t.addEventListener("did-navigate",()=>{this.updateUrlDisplay(),this.updateNavigationButtons()}),t.addEventListener("did-navigate-in-page",()=>{this.updateUrlDisplay(),this.updateNavigationButtons()}),t}onFrameLoad(){this.isFrameReady=!0,this.updateUrlDisplay(),this.loadingSpinner.style.display="none";let t=this.getCurrentUrl();t!==this.navigationHistory[this.currentHistoryIndex]&&(this.navigationHistory=this.navigationHistory.slice(0,this.currentHistoryIndex+1),this.navigationHistory.push(t),this.currentHistoryIndex++,this.updateNavigationButtons())}navigateTo(t){this.url=t,this.navigationHistory.push(this.url),this.currentHistoryIndex=this.navigationHistory.length-1,this.frame.src=this.url,this.updateUrlDisplay()}getCurrentUrl(){var t;return this.frame instanceof HTMLIFrameElement?((t=this.frame.contentWindow)==null?void 0:t.location.href)||this.url:this.frame&&typeof this.frame.getURL=="function"?this.frame.getURL()||this.url:this.url}updateUrlDisplay(){let t=this.getCurrentUrl();this.url=t,this.searchInput&&(this.searchInput.value=t)}updateNavigationButtons(){var t,e;if(this.frame instanceof HTMLIFrameElement)this.backBtn.disabled=this.currentHistoryIndex<=0,this.forwardBtn.disabled=this.currentHistoryIndex>=this.navigationHistory.length-1;else{let i=this.frame;this.backBtn.disabled=!((t=i.canGoBack)!=null&&t.call(i)),this.forwardBtn.disabled=!((e=i.canGoForward)!=null&&e.call(i))}}goBack(){var t,e;if(this.isFrameReady)if(this.loadingSpinner.style.display="block",this.frame instanceof HTMLIFrameElement)this.currentHistoryIndex>0&&(this.currentHistoryIndex--,this.frame.src=this.navigationHistory[this.currentHistoryIndex]);else{let i=this.frame;(t=i.canGoBack)!=null&&t.call(i)&&((e=i.goBack)==null||e.call(i))}}goForward(){var t,e;if(this.isFrameReady)if(this.loadingSpinner.style.display="block",this.frame instanceof HTMLIFrameElement)this.currentHistoryIndex<this.navigationHistory.length-1&&(this.currentHistoryIndex++,this.frame.src=this.navigationHistory[this.currentHistoryIndex]);else{let i=this.frame;(t=i.canGoForward)!=null&&t.call(i)&&((e=i.goForward)==null||e.call(i))}}refresh(){var t;this.isFrameReady&&(this.loadingSpinner.style.display="block",this.frame instanceof HTMLIFrameElement?(t=this.frame.contentWindow)==null||t.location.reload():this.frame.reload())}};var le={defaultWidth:"100%",defaultHeight:"100%"},w=class extends T.Modal{constructor(e,i,n=le,r){var s,a,l;super(e);this.plugin=r,this.settings={defaultWidth:((s=r==null?void 0:r.settings)==null?void 0:s.modalWidth)||n.defaultWidth||"80vw",defaultHeight:((a=r==null?void 0:r.settings)==null?void 0:a.modalHeight)||n.defaultHeight||"80vh"},this.webViewComponent=new v(this.app,i,{defaultWidth:this.settings.defaultWidth,defaultHeight:this.settings.defaultHeight,searchEngine:((l=r==null?void 0:r.settings)==null?void 0:l.searchEngine)||"default"},async o=>{this.plugin&&typeof this.plugin.clipWebpage=="function"?await this.plugin.clipWebpage(o):new T.Notice("Clip webpage function not available")})}onOpen(){let{contentEl:e}=this;this.modalEl.style.width=this.settings.defaultWidth,this.modalEl.style.height=this.settings.defaultHeight;let i=this.webViewComponent.createContainer();e.appendChild(i)}onClose(){let{contentEl:e}=this;e.empty()}};var I=require("obsidian");var g="netClip_workspace_webview",b=class extends I.ItemView{constructor(e,i){super(e);this.initialUrl="";this.icon="globe";this.plugin=i}setUrl(e){this.initialUrl=e,this.reloadWebView()}getViewType(){return g}getDisplayText(){return"Web View"}reloadWebView(){this.containerEl.empty(),this.createWebViewComponent()}createWebViewComponent(){this.webViewComponent=new v(this.app,this.initialUrl,{searchEngine:this.plugin.settings.searchEngine},async i=>{this.plugin&&typeof this.plugin.clipWebpage=="function"?await this.plugin.clipWebpage(i):new I.Notice("Clip webpage function not available")});let e=this.webViewComponent.createContainer();this.containerEl.appendChild(e)}async onOpen(){var i;this.containerEl=this.containerEl.children[1],this.containerEl.empty();let e=(i=this.leaf.getViewState().state)==null?void 0:i.url;this.initialUrl=typeof e=="string"&&e||this.plugin.settings.defaultWebUrl||"https://google.com",this.createWebViewComponent()}async onClose(){this.containerEl.empty()}};var W=class{constructor(t,e,i,n,r){this.app=t,this.file=e,this.url=r,this.onDelete=i,this.onOpenArticle=n,this.plugin=this.app.plugins.getPlugin("net-clip")}show(t){let e=new E.Menu;e.addItem(n=>{n.setTitle("Open page in Editor").setIcon("globe").onClick(()=>{if(this.url){let r=this.app.workspace.getLeavesOfType(g).find(s=>s.view.url===this.url);if(r)this.app.workspace.setActiveLeaf(r,{focus:!0});else{let s=this.app.workspace.getLeaf("tab");s.setViewState({type:g,state:{url:this.url}}).then(()=>{s.view instanceof b&&(s.view.setUrl(this.url),this.app.workspace.setActiveLeaf(s,{focus:!0}))})}}else new E.Notice("No URL found for this clipping")})}),e.addItem(n=>{n.setTitle("Open page in Modal").setIcon("maximize").onClick(()=>{this.url?new w(this.app,this.url,void 0,this.plugin).open():new E.Notice("No URL found for this clipping")})}),e.addItem(n=>{n.setTitle("Open in Editor").setIcon("file-text").onClick(()=>{this.onOpenArticle(this.file)})}),e.addItem(n=>{n.setTitle("Delete").setIcon("trash").onClick(()=>{this.onDelete(this.file)})});let i=t.getBoundingClientRect();e.showAtPosition({x:i.left,y:i.bottom})}};var m="netClip_clipper_view",H=class extends X.ItemView{constructor(e,i){super(e);this.icon="newspaper";this.plugin=i,this.settings=i.settings}getViewType(){return m}getDisplayText(){return"Clipper View"}async onOpen(){this.containerEl=this.containerEl.children[1],this.containerEl.empty();let e=this.containerEl.createEl("div",{cls:"net_clipper_container"}),n=e.createEl("div",{cls:"net_clipper_header"}).createEl("span",{cls:"netopen_Web"});n.innerHTML=`
         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe">
           <circle cx="12" cy="12" r="10"/>
           <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/>
           <path d="M2 12h20"/>
         </svg>
         `;let r=e.createEl("div",{cls:"netclip_input_container"});n.addEventListener("click",async()=>{let o=this.settings.defaultWebUrl||"https://google.com",p=this.app.workspace.getLeavesOfType(g).find(h=>h.view.url===o);if(p)this.app.workspace.setActiveLeaf(p,{focus:!0});else{let h=this.app.workspace.getLeaf(!0);await h.setViewState({type:g,state:{url:o}}),this.app.workspace.setActiveLeaf(h,{focus:!0})}});let s=r.createEl("input",{cls:"net_clip_input",type:"text",placeholder:"Enter URL to clip..."});r.createEl("button",{cls:"netclip_btn",text:"Clip"}).addEventListener("click",()=>{if(s.value){let o=x(s.value);o&&this.plugin.clipWebpage(o),s.value=""}});let l=e.createEl("div",{cls:"netclip_saved_container"});await this.renderSavedContent(l)}async renderSavedContent(e){e.empty();let n=this.app.vault.getMarkdownFiles().filter(r=>r.path.startsWith(this.settings.defaultFolderName));if(n.length===0){let r=e.createEl("div",{cls:"empty_box"}),s=r.createEl("span",{cls:"empty_icon"});s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="75" height="75" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open"><path d="M12 7v14"/><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>',r.createEl("p",{text:"No articles saved yet."});return}for(let r of n){let s=await this.app.vault.read(r),a=e.createEl("div",{cls:"netClip_card"}),l=s.match(/!\[Thumbnail\]\((.+)\)/),o=l?l[1]:"https://cdn.pixabay.com/photo/2023/12/14/06/45/chicken-8448262_1280.jpg";a.createEl("img",{attr:{src:o}}),a.createEl("h6",{text:r.basename}).addEventListener("click",()=>{this.openArticle(r)});let h=a.createEl("div",{cls:"netclip_card_bottom"}),d=s.match(/source: "([^"]+)"/);if(d){let y=d[1],C=k(y);h.createEl("a",{cls:"domain",href:y,text:C})}else h.createEl("span",{cls:"domain",text:"Unknown Source"});this.createMenuButton(h,r,d==null?void 0:d[1]),e.appendChild(a)}}createMenuButton(e,i,n){let r=e.createEl("span",{cls:"menu-button"});r.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#fff" viewBox="0 0 256 256">
                <path d="M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128ZM128,72a12,12,0,1,0-12-12A12,12,0,0,0,128,72Zm0,112a12,12,0,1,0,12,12A12,12,0,0,0,128,184Z"></path>
            </svg>`,r.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),new W(this.app,i,this.showDeleteConfirmation.bind(this),this.openArticle.bind(this),n).show(r)})}showDeleteConfirmation(e){new S(this.app,e,async()=>{await this.app.vault.delete(e);let n=this.containerEl.querySelector(".netclip_saved_container");await this.renderSavedContent(n)}).open()}openArticle(e){let n=this.app.workspace.getLeavesOfType("markdown").find(r=>{var a;let s=r.getViewState();return s.type==="markdown"&&((a=s.state)==null?void 0:a.file)===e.path});n?this.app.workspace.revealLeaf(n):this.app.workspace.openLinkText(e.path,"",!0)}};var u=require("obsidian");var J={viewPosition:"default",defaultFolderName:"Saved Articles",defaultWebUrl:"https://google.com",modalWidth:"80vw",modalHeight:"80vh",searchEngine:"google"},N=class extends u.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i,this.id="net-clip-settings"}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"NetClip Settings"}),new u.Setting(e).setName("View Position").setDesc("Choose where the Web Clipper view should appear").addDropdown(i=>i.addOption("left","Left Sidebar").addOption("right","Right Sidebar").addOption("default","Default Position").setValue(this.plugin.settings.viewPosition).onChange(async n=>{this.plugin.settings.viewPosition=n,await this.plugin.saveSettings();let r=this.app.workspace.getLeavesOfType(m);r.length>0&&(r[0].detach(),this.plugin.activateView())})),new u.Setting(e).setName("Default Folder Name").setDesc("Set the default folder where clipped articles are saved").addText(i=>i.setPlaceholder("Enter folder name").setValue(this.plugin.settings.defaultFolderName).onChange(async n=>{if(n.trim()===""){new u.Notice("Folder name cannot be empty.");return}this.plugin.settings.defaultFolderName=n,await this.plugin.saveSettings()})),new u.Setting(e).setName("Modal Height").setDesc("Set the default height for the web modal (use CSS units like vh, %, px)").addText(i=>i.setPlaceholder("80vh").setValue(this.plugin.settings.modalHeight).onChange(async n=>{this.plugin.settings.modalHeight=n||"80vh",await this.plugin.saveSettings()})),new u.Setting(e).setName("Modal Width").setDesc("Set the default height for the web modal (use CSS units like vh, %, px)").addText(i=>i.setPlaceholder("80vh").setValue(this.plugin.settings.modalWidth).onChange(async n=>{this.plugin.settings.modalWidth=n||"80vh",await this.plugin.saveSettings()})),new u.Setting(e).setName("Search Engine").setDesc("Choose the default search engine for search queries").addDropdown(i=>i.addOption("google","Google").addOption("youtube","YouTube").addOption("bing","Bing").addOption("perplexity","Perplexity").addOption("duckduckgo","Duckduckgo").addOption("genspark","Genspark").addOption("kagi","Kagi").setValue(this.plugin.settings.searchEngine).onChange(async n=>{console.log("Selected Search Engine:",n),this.plugin.settings.searchEngine=n,await this.plugin.saveSettings()})),new u.Setting(e).setName("Default Web Modal URL").setDesc("Set the default URL opened when using the web modal/editor").addText(i=>i.setPlaceholder("Enter default URL").setValue(this.plugin.settings.defaultWebUrl).onChange(async n=>{try{new URL(n),this.plugin.settings.defaultWebUrl=n,await this.plugin.saveSettings()}catch(r){new u.Notice("Invalid URL. Please enter a valid URL.")}}))}};var M=class{constructor(t){this.recentLinks=new Set;this.seenImages=new Set;this.firstImageProcessed=!1;this.plugin=t}resetProcessingFlags(){this.firstImageProcessed=!1,this.seenImages.clear(),this.recentLinks.clear()}processNode(t,e){var r;if(t.nodeType===Node.TEXT_NODE)return(t.textContent||"").trim();if(!(t instanceof HTMLElement))return"";let i="",n=t;switch(n.tagName){case"BLOCKQUOTE":{let s=Array.from(n.childNodes).map(a=>this.processNode(a,e)).join("").trim();s&&(i+=`> ${s.replace(/\n/g,`
> `)}

`);break}case"A":{let s=n.getAttribute("href"),a=((r=n.textContent)==null?void 0:r.trim())||"";if(s&&a){let l=n.previousSibling,o=n.nextSibling,p=this.shouldAddSpace(l),h=this.shouldAddSpace(o),d=this.resolveUrl(e,s);this.isRepeatedLink(a,d)||(i+=`${p}[${a}](${d})${h}`)}break}case"STRONG":{i+=`**${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}**`;break}case"EM":{i+=`*${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}*`;break}case"H1":{i+=`# ${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}

`;break}case"H2":{i+=`## ${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}

`;break}case"H3":{i+=`### ${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}

`;break}case"H4":{i+=`#### ${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}

`;break}case"H5":{i+=`##### ${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}

`;break}case"H6":{i+=`###### ${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}

`;break}case"TABLE":{i+=this.processTableElement(n);break}case"UL":{i+=Array.from(n.childNodes).map(s=>this.processNode(s,e)).filter(s=>s.trim()).map(s=>`- ${s.trim()}`).join(`
`)+`

`;break}case"OL":{i+=Array.from(n.childNodes).map(s=>this.processNode(s,e)).filter(s=>s.trim()).map(s=>`- ${s.trim()}`).join(`
`)+`

`;break}case"P":{i+=Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")+`

`;break}case"BR":{i+=`
`;break}case"HR":{i+=`---

`;break}case"IMG":{let s=this.resolveImageSrc(t,e);if(s){let a=t.getAttribute("alt")||"Image";if(t.closest('.heading,[class*="thumbnailImage"]')||a.toLowerCase()==="heading")break;if(!this.firstImageProcessed){this.firstImageProcessed=!0;break}this.seenImages.has(s)||(i+=`![${a}](${s})

`,this.seenImages.add(s))}break}case"FIGCAPTION":{i+=`*${Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("")}*

`;break}case"IFRAME":{let s=n.getAttribute("src"),a=n.getAttribute("title")||"Embedded Video/Content";s&&(i+=`<iframe src="${s}" title="${a}"></iframe>

`);break}case"CODE":{let s=n.textContent||"";i+=`\`\`\`
${s.trim()}
\`\`\`

`;break}case"PRE":{let s=Array.from(n.childNodes).map(a=>this.processNode(a,e)).join("");i+=`\`\`\`
${s.trim()}
\`\`\`

`;break}default:{i+=Array.from(n.childNodes).map(s=>this.processNode(s,e)).join("");break}}return i}shouldAddSpace(t){var e;if(!t)return"";if(t.nodeType===Node.TEXT_NODE){let i=((e=t.textContent)==null?void 0:e.trim())||"";return i&&!i.endsWith(" ")?" ":""}return""}isRepeatedLink(t,e){let i=`${t}:${e}`;if(this.recentLinks.has(i))return!0;if(this.recentLinks.add(i),this.recentLinks.size>10){let n=this.recentLinks.values().next().value;this.recentLinks.delete(n)}return!1}resolveImageSrc(t,e){let i=["data-src","src","data-original","data-lazy","data-fallback-src","srcset"];for(let n of i){let r=t.getAttribute(n);if(n==="data-src"&&!r&&(r=t.getAttribute("src")),n==="srcset"&&r&&(r=r.split(",")[0].trim().split(" ")[0]),r)return r.startsWith("data:")||r.startsWith("http")?r:this.resolveUrl(e,r)}return""}processTableElement(t){let e=`

`,i=t.querySelector("thead"),n=t.querySelector("tbody");return i&&i.querySelectorAll("tr").forEach(a=>{let l=Array.from(a.querySelectorAll("th,td")),o=l.map(h=>{var d;return((d=h.textContent)==null?void 0:d.trim().replace(/\|/g,"\\|"))||""}).join("|"),p=l.map(()=>"---").join("|");e+=`${o}
${p}
`}),(n?n.querySelectorAll("tr"):t.querySelectorAll("tr")).forEach((s,a)=>{if(i&&a<i.querySelectorAll("tr").length)return;let o=Array.from(s.querySelectorAll("th,td")).map(p=>{var h;return((h=p.textContent)==null?void 0:h.trim().replace(/\|/g,"\\|"))||""}).join("|");e+=`${o}
`}),e+=`
`,e}resolveUrl(t,e){try{return new URL(e,t).toString()}catch(i){return e}}};var A=class{constructor(t){this.plugin=t,this.processNodeHelper=new M(t)}extractMainContent(t,e){this.processNodeHelper.resetProcessingFlags();let i=["main","article",".main-content","#main-content",".entry-content","#productDescription","#feature-bullets",".markdown",'[class*="blog"]',"#centerCol",".a-section.a-spacing-none",".Blog",'[class*="blog"]'],n=this.findMainContentElement(t,i);return this.removeUnnecessaryElements(n),this.processNodeHelper.processNode(n,e).replace(/\n{5,}/g,`

`).trim()}findMainContentElement(t,e){for(let i of e){let n=t.querySelector(i);if(n)return n}return t.body}removeUnnecessaryElements(t){t.querySelectorAll("*").forEach(n=>{n.className&&/\brelated\b/i.test(n.className)&&n.remove()});let e=["script","style","svg","nav","footer","header","aside",'[class*="footer"]','[class*="nav"]','[class*="sidebar"]','[class*="sticky"]',".ad-container",".advertisement",".cookie-consent",".menu",'[class*="menu"]',".tags",'[class*="tags"]','[class*="popup"]','[class*="related"]',".related",'[class*="header"]','[class*="newsletter"]','[class*="form"]','[aria-label="Navigation"]','[class*="share"]','[class*="author"]',".read-next",'[class*="read-next"]','[data-module="newsletter"]','[data-component="navigation"]','[class*="icon"]',".flex-col"].join(","),i=["main","article",'[class*="article"]','[class*="main"]',".article","p","img","ul","ol",'[class*="blog"]',".entry-content",".Blog","header"];t.querySelectorAll(e).forEach(n=>{let r=n.tagName.toLowerCase();i.includes(r)||n.remove()})}extractDescription(t){var r,s;let e=(r=t.querySelector('meta[name="description"]'))==null?void 0:r.getAttribute("content"),i=(s=t.querySelector('meta[property="og:description"]'))==null?void 0:s.getAttribute("content"),n=e||i;return n?n.replace(/[<>#"]/g,"").trim():null}extractThumbnail(t){let e=t.querySelector('meta[property="og:image"]'),i=t.querySelector(".a-dynamic-image"),n=e==null?void 0:e.getAttribute("content"),r=i==null?void 0:i.getAttribute("src");return n||r||""}extractPublishTime(t){var i;return((i=t.querySelector('meta[property="article:published_time"]'))==null?void 0:i.getAttribute("content"))||""}extractAuthor(t){var s,a,l;let e=(s=t.querySelector('meta[name="author"]'))==null?void 0:s.getAttribute("content"),i=Array.from(t.querySelectorAll('[class*="Author"],[class*="author"],[id*="Author"],[id*="author"]')).find(o=>{var p;return(p=o.textContent)==null?void 0:p.trim()}),n=(a=i==null?void 0:i.textContent)==null?void 0:a.trim(),r=(l=t.querySelector('meta[name="publisher"],meta[property="og:site_name"]'))==null?void 0:l.getAttribute("content");return e||n||r||""}extractPrice(t){var i;let e=[".price",'meta[itemprop="price"]',".current-price",".x-price-primary",".priceToPay",".a-price"];for(let n of e){let r=t.querySelector(n);if(r)return((i=r.textContent)==null?void 0:i.trim())||null}return null}extractBrand(t){var i;let e=["#bylineInfo"];for(let n of e){let r=t.querySelector(n);if(r){let s=((i=r.textContent)==null?void 0:i.trim())||"",a=r.querySelector("a"),l=a==null?void 0:a.getAttribute("href");if(l){let o=this.resolveUrl(l,window.location.href);return`[${s}](${o})`}return s}}return null}extractRating(t){var n;let e=["#acrPopover",'meta[itemprop="rating"]','meta[itemprop="review"]',".average-rating",".star-rating",'[class*="rating"]'],i=null;for(let r of e){let s=t.querySelector(r);if(s){let a=(n=s.textContent)==null?void 0:n.trim();if(a){i=a;break}}}if(!i){let r=Array.from(t.querySelectorAll("span, div")).find(s=>{var a;return(a=s.textContent)==null?void 0:a.trim().match(/^★+$/)});r&&(i=`${r.textContent.length} out of 5 stars`)}if(i){let r=i.match(/(\d+(\.\d+)?)\s*out\s*of\s*5/i);if(r){let a=parseFloat(r[1]),l=Math.round(a),o="\u2605".repeat(l)+"\u2606".repeat(5-l);return`${a} out of 5 stars (${o})`}let s=i.match(/★+/);if(s){let a=s[0].length,l="\u2605".repeat(a)+"\u2606".repeat(5-a);return`${a} out of 5 stars (${l})`}}return null}resolveUrl(t,e){try{return new URL(e,t).toString()}catch(i){return e}}};var P=class extends f.Plugin{constructor(){super(...arguments);this.ClipperView=null;this.seenItems=new Set;this.seenImages=new Set}isNewContent(e){return this.seenItems.has(e)?!1:(this.seenItems.add(e),!0)}processContent(e){return e.split(`
`).filter(r=>this.isNewContent(r.trim())).join(`
`)}async onload(){await this.loadSettings(),this.contentExtractors=new A(this),this.addRibbonIcon("newspaper","NetClip",async()=>{await this.activateView()}),this.addCommand({id:"open-net-clip",name:"OpenNetClip",callback:()=>{this.activateView()}}),this.addCommand({id:"open-workspace-webview",name:"Open Web View on Workspace",callback:async()=>{let e=this.app.workspace.getLeaf(!0);await e.setViewState({type:g,active:!0}),this.app.workspace.revealLeaf(e)},hotkeys:[{modifiers:["Ctrl","Alt"],key:"x"}]}),this.addCommand({id:"open-web-modal",name:"Open Web view on Modal",checkCallback:e=>{if(e)return!0;let i=this.settings.defaultWebUrl||"https://google.com";new w(this.app,i,void 0,this).open()},hotkeys:[{modifiers:["Ctrl","Alt"],key:"z"}]}),this.registerView(m,e=>(this.ClipperView=new H(e,this),this.ClipperView)),this.registerView(g,e=>new b(e,this)),this.addSettingTab(new N(this.app,this))}async loadSettings(){this.settings=Object.assign({},J,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:e}=this.app,i=null,n=e.getLeavesOfType(m);if(n.length>0)i=n[0];else switch(this.settings.viewPosition){case"left":i=e.getLeftLeaf(!1);break;case"right":i=e.getRightLeaf(!1);break;default:i=e.getLeaf(!1)}i&&(await i.setViewState({type:m,active:!0}),e.revealLeaf(i))}async clipWebpage(e){var j;if(!this.contentExtractors)return;new f.Notice("Clipping...");let i=this.settings.defaultFolderName;this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i);let r=x(e);if(!r)throw new Error("Invalid URL provided");let a=(await(0,f.requestUrl)(r)).text,o=new DOMParser().parseFromString(a,"text/html"),p=((j=o.querySelector("title"))==null?void 0:j.textContent)||"";if(!p){let _=o.querySelector("h1")||o.querySelector(".title");_&&_.textContent&&(p=_.textContent.trim())}p||(p=`Article from ${k(e)}`),p=p.replace(/[#"]/g,"").trim();let h=this.contentExtractors.extractMainContent(o,r),d=this.contentExtractors.extractThumbnail(o),y=this.contentExtractors.extractAuthor(o),C=this.contentExtractors.extractDescription(o),D=this.contentExtractors.extractPublishTime(o),B=this.contentExtractors.extractPrice(o),F=this.contentExtractors.extractBrand(o),R=this.contentExtractors.extractRating(o),$=h.split(/\s+/).length,U=Math.floor($/250),q=Math.ceil($/200),O=U===q?`${U}`:`${U}~${q}`,ee=G(`${p}.md`),te=`${i}/${ee}`;await this.app.vault.create(te,`---
title: "${p}"
source: "${e}"
`+(D?`published: ${D}
`:"")+(y?`author: "${y}"
`:"")+(C?`desc: "${C}"
`:"")+(O?`readingTime: "${O}min"
`:"")+(B?`price: "${B}"
`:"")+(F?`brand: "${F}"
`:"")+(R?`brand: "${R}"
`:"")+`---

`+(d?`![Thumbnail](${d})

`:"")+`${h}`),await this.updateHomeView(),new f.Notice(`Successfully clipped ${p}`)}async updateHomeView(){if(this.ClipperView){let e=this.ClipperView.containerEl.querySelector(".netclip_saved_container");e instanceof HTMLDivElement&&await this.ClipperView.renderSavedContent(e)}}};
